<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI æ•™ç¨‹ - ç¬¬21-22è¯¾: MCPä¸å¤©æ°”åº”ç”¨ (è¶…å°ç™½ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.8;
            background-color: #f0f4f8; /* æ›´æŸ”å’Œçš„æ·¡è“è‰²èƒŒæ™¯ */
            color: #333a45; 
        }
        .container {
            max-width: 850px; /* ç¨å¾®åŠ å®½ä¸€ç‚¹ç‚¹ */
            margin: 25px auto; 
            padding: 30px;
            background-color: #ffffff;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.07); 
            border-radius: 12px; /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
        }
        h1, h2, h3 {
            font-weight: 700; /* æ ‡é¢˜åŠ ç²—ä¸€äº› */
            margin-top: 1.8em;
            margin-bottom: 0.8em;
            color: #1a2b4d; /* æ·±æµ·å†›è“æ ‡é¢˜ */
        }
        h1 {
            font-size: 2.3rem; 
            border-bottom: 3px solid #dbe4f0; /* æ ‡é¢˜ä¸‹åˆ’çº¿æ›´æ˜æ˜¾ */
            padding-bottom: 0.7rem;
            text-align: center; 
            margin-bottom: 1.2em; 
        }
        h2 {
            font-size: 1.9rem; /* H2ä¹Ÿå¤§ä¸€ç‚¹ */
            color: #2c3e50; 
            border-bottom: 2px dashed #e0e6ed; 
            padding-bottom: 0.5rem;
            margin-top: 2.2em; 
        }
        h3 {
            font-size: 1.5rem; /* H3ä¹Ÿå¤§ä¸€ç‚¹ */
            color: #34495e; 
        }
        p, li {
            margin-bottom: 1.1em;
            color: #4a5568; /* æ–‡æœ¬é¢œè‰²ç¨æ·± */
            font-size: 1.1em; /* æ–‡æœ¬ç¨å¤§ */
        }
        ul, ol { /* ç»™æœ‰åºåˆ—è¡¨ä¹ŸåŠ ä¸Šæ ·å¼ */
            list-style-position: outside;
            padding-left: 30px;
        }
        ul li::marker { /* æ›´æ”¹æ— åºåˆ—è¡¨æ ‡è®°é¢œè‰² */
            color: #3498db;
        }
        ol li::marker { /* æ›´æ”¹æœ‰åºåˆ—è¡¨æ ‡è®°é¢œè‰² */
            color: #2ecc71;
            font-weight: bold;
        }
        code:not(pre code) {
            background-color: #eaf2f8; 
            padding: 0.3em 0.6em;
            margin: 0 0.15em;
            font-size: 90%;
            border-radius: 5px;
            color: #1f618d; 
            border: 1px solid #d6eaf8;
            font-family: 'Fira Code', monospace;
        }
        pre {
            background-color: #2c3e50; /* ä»£ç å—èƒŒæ™¯ç”¨æ·±æµ·å†›è“ */
            color: #e0e6f0; /* ä»£ç å—æ–‡å­—ç”¨æµ…ç°è‰² */
            padding: 1.5em; /* ä»£ç å—å†…è¾¹è·åŠ å¤§ */
            border-radius: 10px; /* ä»£ç å—è¾¹è§’æ›´åœ†æ¶¦ */
            overflow-x: auto;
            margin-top: 0.5em; /* ä»£ç å—ä¸ä¸Šæ–¹è§£é‡Šçš„é—´è· */
            margin-bottom: 1.8em;
            font-size: 1em; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        pre code {
            font-family: 'Fira Code', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", monospace; 
        }
        .note {
            background-color: #e6f7ff; 
            border-left: 6px solid #007ace; /* è“è‰²è°ƒ */
            padding: 1.5em;
            margin-top: 1em;
            margin-bottom: 1.5em;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 122, 206, 0.1);
        }
        .note p, .note li { 
            margin-bottom: 0.6em;
            color: #005a8c; 
        }
        .note p:last-child, .note li:last-child {
             margin-bottom: 0;
        }
        .tip { /* æ–°å¢æç¤ºæ ·å¼ */
            background-color: #e8fdf8;
            border-left: 6px solid #1abc9c; /* ç»¿è‰²è°ƒ */
            padding: 1.5em;
            margin-top: 1em;
            margin-bottom: 1.5em;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(26, 188, 156, 0.1);
        }
        .tip p, .tip li {
            color: #107c68;
        }
        .warning { /* æ–°å¢è­¦å‘Šæ ·å¼ */
            background-color: #fff4e6;
            border-left: 6px solid #f39c12; /* æ©™è‰²è°ƒ */
            padding: 1.5em;
            margin-top: 1em;
            margin-bottom: 1.5em;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.1);
        }
        .warning p, .warning li {
            color: #b06c0a;
        }
        .output {
            background-color: #e8f6f3; 
            border: 1px solid #a3e4d7; 
            padding: 1em;
            border-radius: 8px;
            margin-top: 0.6em;
            margin-bottom: 1.2em;
            font-family: 'Fira Code', monospace; 
            font-size: 0.95em; 
            white-space: pre-wrap;
            word-wrap: break-word;
            color: #138d75; 
        }
        .visual-explanation {
            background-color: #fdf2e9; /* æµ…æ©™è‰²èƒŒæ™¯ */
            border: 2px dashed #f5cba7; 
            padding: 1.5em;
            margin-top: 1.2em;
            margin-bottom: 1.8em;
            border-radius: 10px;
            font-family: 'Fira Code', monospace; 
            font-size: 1em;
        }
        .visual-explanation h4 {
            font-weight: 700;
            color: #af601a; 
            margin-bottom: 0.8em;
            font-family: 'Inter', sans-serif;
            font-size: 1.2em;
        }
        .visual-explanation pre {
            background-color: #fae5d3; 
            color: #6e2c00; 
            padding: 0.8em;
            border-radius: 6px;
        }
        .emoji { 
            font-size: 1.3em; /* emojiç¨å¤§ä¸€äº› */
            margin-right: 0.4em;
            vertical-align: -0.1em; /* å¾®è°ƒå‚ç›´å¯¹é½ */
        }
        hr.section-divider { 
            border: 0;
            height: 2px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(26, 43, 77, 0.6), rgba(0, 0, 0, 0)); /* åˆ†å‰²çº¿é¢œè‰²è°ƒæ•´ */
            margin-top: 3.5em;
            margin-bottom: 3.5em;
        }
        .ai-prompt { /* AIæç¤ºè¯çš„ä¸“å±æ ·å¼ */
            background-color: #f0ebf8; /* æ·¡ç´«è‰²èƒŒæ™¯ */
            border-left: 6px solid #8e44ad; /* ç´«è‰²è¾¹æ¡† */
            padding: 1em 1.5em;
            margin-top: -1em; /* ç´§è´´ä»£ç å—ä¸Šæ–¹ */
            margin-bottom: 1.5em;
            border-radius: 0 0 8px 8px; /* åº•éƒ¨åœ†è§’ï¼Œæ¨¡æ‹Ÿé™„ç€æ„Ÿ */
            font-style: italic;
            color: #5b2c6f;
            font-size: 0.95em;
        }
        .ai-prompt strong {
            color: #4a235a;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="container bg-white shadow-lg rounded-lg p-8 my-10">
        <h1><span class="emoji">ğŸ—ï¸</span>FastAPI æ¢é™©æ–°é«˜åº¦: MCPæ¶æ„ä¸å®æˆ˜åº”ç”¨<span class="emoji">ğŸŒ¦ï¸</span></h1>

        <section id="lesson21-fastapi-mcp">
            <h2><span class="emoji">ğŸ—ºï¸</span>ç¬¬äºŒåä¸€ç«™: ç»™é¡¹ç›®æ­ä¸ªå¥½æ¶å­â€”â€”FastAPI MCPåˆæ¢</h2>
            <p>å¤§å®¶å¥½ï¼Œå°å°æ¢é™©å®¶ä»¬ï¼ä¹‹å‰æˆ‘ä»¬å­¦ä¹ äº† FastAPI çš„å¾ˆå¤šé›¶æ•£çš„â€œå°é­”æ³•â€ï¼Œæ¯”å¦‚æ€ä¹ˆå®šä¹‰ç½‘å€ã€æ€ä¹ˆæ¥æ”¶å’Œå›å¤ä¿¡æ¯ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¦å­¦ç‚¹æ›´â€œé«˜å¤§ä¸Šâ€çš„ä¸œè¥¿äº†â€”â€”æ€ä¹ˆæŠŠæˆ‘ä»¬çš„ä»£ç ç»„ç»‡å¾—åƒä¸€ä¸ªæ•´é½çš„å·¥å…·ç®±ï¼Œè€Œä¸æ˜¯ä¹±ç³Ÿç³Ÿçš„æŠ½å±‰ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¿™ç«™è¦èŠçš„ "MCP"ã€‚</p>
            <p>MCP è¿™ä¸ªè¯å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹å“äººï¼Œä½†åˆ«æ€•ï¼ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ç§<strong>ç›–æˆ¿å­çš„â€œè“å›¾â€æˆ–è€…â€œè¯´æ˜ä¹¦â€</strong>ã€‚æŒ‰ç…§è¿™ä¸ªè“å›¾ç›–æˆ¿å­ï¼ˆå†™ä»£ç ï¼‰ï¼Œæˆ¿å­å°±ä¼šæ›´ç¨³å›ºã€æ›´å®¹æ˜“è£…ä¿®ï¼ˆä¿®æ”¹ä»£ç ï¼‰ã€ä¹Ÿæ›´å®¹æ˜“è®©åˆ«äººçœ‹æ‡‚ä½ çš„è®¾è®¡ã€‚</p>
            <p>åœ¨ FastAPI çš„ä¸–ç•Œé‡Œï¼ŒMCP é€šå¸¸æŒ‡çš„æ˜¯ä¸€ç§æŠŠé¡¹ç›®ä»£ç åˆ†æˆä¸åŒâ€œæˆ¿é—´â€çš„æ–¹æ³•ï¼Œæ¯ä¸ªâ€œæˆ¿é—´â€è´Ÿè´£ä¸åŒçš„äº‹æƒ…ã€‚è¿™æ ·ä»£ç å°±ä¸ä¼šæŒ¤åœ¨ä¸€èµ·ï¼Œæ‰¾ä¸œè¥¿ã€ä¿®ä¸œè¥¿éƒ½æ–¹ä¾¿å¤šå•¦ï¼</p>

            <section id="mcp-concept">
                <h3><span class="emoji">ğŸ¤”</span>21.1 MCP åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿï¼ˆå°ç™½ç‰ˆè§£é‡Šï¼‰</h3>
                <p>MCP æ˜¯å‡ ä¸ªè‹±æ–‡å•è¯çš„ç¼©å†™ï¼Œä½†å’±ä»¬å…ˆä¸ç®¡é‚£äº›è‹±æ–‡ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆï¼š</p>
                <ul>
                    <li><strong>M (Model - æ¨¡å‹/æ•°æ®ç®¡ç†å‘˜)</strong>: è¿™ä¸ªâ€œæˆ¿é—´â€ä¸“é—¨è´Ÿè´£ç®¡ç†æˆ‘ä»¬çš„â€œæ•°æ®è“å›¾â€ã€‚è¿˜è®°å¾—æˆ‘ä»¬ç”¨ Pydantic å®šä¹‰çš„é‚£äº› <code>Item</code>ã€<code>User</code> æ¨¡å‹å—ï¼Ÿå®ƒä»¬å°±ä½åœ¨è¿™ä¸ªæˆ¿é—´ã€‚å®ƒè§„å®šäº†æˆ‘ä»¬çš„æ•°æ®åº”è¯¥é•¿ä»€ä¹ˆæ ·ã€‚</li>
                    <li><strong>C (Controller/Router - æ§åˆ¶å™¨/äº¤é€šæŒ‡æŒ¥å‘˜)</strong>: è¿™ä¸ªâ€œæˆ¿é—´â€åƒæ˜¯æˆ‘ä»¬ç½‘ç«™çš„â€œäº¤é€šæŒ‡æŒ¥éƒ¨â€ã€‚å®ƒè´Ÿè´£æ¥æ”¶ä»æµè§ˆå™¨å‘æ¥çš„å„ç§è¯·æ±‚ï¼ˆæ¯”å¦‚ç”¨æˆ·æƒ³çœ‹å“ªä¸ªé¡µé¢ã€æƒ³æäº¤ä»€ä¹ˆä¿¡æ¯ï¼‰ï¼Œç„¶åå†³å®šæŠŠè¿™äº›è¯·æ±‚äº¤ç»™å“ªä¸ªâ€œå·¥äººâ€å»å¤„ç†ã€‚æˆ‘ä»¬ä¹‹å‰å†™çš„ <code>@app.get("/")</code>ã€<code>@app.post("/items/")</code> è¿™äº›ï¼Œå°±å±äºè¿™ä¸ªæˆ¿é—´çš„å·¥ä½œã€‚</li>
                    <li><strong>P (Presenter/Service/Logic - å±•ç¤ºå‘˜/æœåŠ¡å‘˜/é€»è¾‘å¤„ç†å‘˜)</strong>: è¿™ä¸ªâ€œæˆ¿é—´â€æ˜¯çœŸæ­£å¹²æ´»çš„åœ°æ–¹ï¼å½“â€œäº¤é€šæŒ‡æŒ¥å‘˜â€æŠŠè¯·æ±‚åˆ†é…è¿‡æ¥åï¼Œè¿™é‡Œçš„â€œå·¥äººâ€å°±è´Ÿè´£å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ¯”å¦‚ä»æ•°æ®åº“é‡Œæ‰¾ä¸œè¥¿ã€è®¡ç®—æ•°æ®ã€æˆ–è€…è°ƒç”¨å…¶ä»–å·¥å…·æ¥å®Œæˆä»»åŠ¡ã€‚ç„¶åå®ƒä¼šæŠŠå¤„ç†å¥½çš„ç»“æœå‘Šè¯‰â€œäº¤é€šæŒ‡æŒ¥å‘˜â€ï¼Œå†ç”±æŒ‡æŒ¥å‘˜å›å¤ç»™ç”¨æˆ·ã€‚</li>
                </ul>
                <div class="visual-explanation">
                    <h4><span class="emoji">ğŸ </span>å›¾è§£ï¼šMCP å°±åƒåˆ†å·¥åˆä½œçš„å·¥åŠ</h4>
                    <pre>
ç”¨æˆ· (æµè§ˆå™¨) --(å‘å‡ºè¯·æ±‚)--> [ C: äº¤é€šæŒ‡æŒ¥å‘˜ (Router) ]
                                      | (åˆ†é…ä»»åŠ¡)
                                      v
                                [ P: é€»è¾‘å¤„ç†å‘˜ (Service) ]
                                      ^   | (éœ€è¦æ•°æ®è“å›¾ï¼Ÿ)
                                      |   v
                                [ M: æ•°æ®ç®¡ç†å‘˜ (Model) ] -- (æä¾›æ•°æ®è“å›¾/æ ¡éªŒæ•°æ®)
                                      |
                                      v (å¤„ç†ç»“æœ)
ç”¨æˆ· (æµè§ˆå™¨) &lt;--(å›å¤ä¿¡æ¯)-- [ C: äº¤é€šæŒ‡æŒ¥å‘˜ (Router) ] &lt;--(æ‹¿åˆ°å¤„ç†ç»“æœ)
                    </pre>
                </div>
                <p>ç”¨ MCP çš„å¥½å¤„å°±æ˜¯ï¼Œæ¯ä¸ªâ€œæˆ¿é—´â€å„å¸å…¶èŒï¼Œä»£ç ä¸ä¼šæ··åœ¨ä¸€èµ·ï¼Œä»¥åé¡¹ç›®å˜å¤§äº†ï¼Œä¹Ÿæ›´å®¹æ˜“ç»´æŠ¤å’Œæ·»åŠ æ–°åŠŸèƒ½ã€‚</p>
            </section>

            <section id="mcp-project-structure">
                <h3><span class="emoji">ğŸ“</span>21.2 æŒ‰ MCP æ•´ç†æˆ‘ä»¬çš„â€œæ–‡ä»¶å¤¹â€ï¼ˆé¡¹ç›®ç»“æ„ï¼‰</h3>
                <p>ä¸ºäº†è®©ä»£ç æ›´æ•´é½ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒçš„æ–‡ä»¶å¤¹æ¥å­˜æ”¾ä¸åŒâ€œæˆ¿é—´â€çš„ä»£ç ã€‚ä¸€ä¸ªå¸¸è§çš„ FastAPI MCP é¡¹ç›®ç»“æ„å¯èƒ½é•¿è¿™æ ·ï¼š</p>
                <div class="visual-explanation">
                    <h4><span class="emoji">ğŸ—‚ï¸</span>å›¾è§£ï¼šä¸€ä¸ªç®€å•çš„ MCP é¡¹ç›®æ–‡ä»¶å¤¹æ ·å­</h4>
                    <pre>
my_awesome_project/
â”œâ”€â”€ app/                     &lt;-- æˆ‘ä»¬ä¸»è¦çš„ FastAPI åº”ç”¨ä»£ç éƒ½åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ __init__.py          &lt;-- è®© Python çŸ¥é“è¿™æ˜¯ä¸ªåŒ…
â”‚   â”œâ”€â”€ main.py              &lt;-- FastAPI åº”ç”¨çš„ä¸»å…¥å£ï¼Œåˆ›å»º app å®ä¾‹çš„åœ°æ–¹
â”‚   â”œâ”€â”€ core/                &lt;-- æ ¸å¿ƒé…ç½®ã€é€šç”¨å·¥å…·ç­‰
â”‚   â”‚   â”œâ”€â”€ config.py        &lt;-- æ”¾ä¸€äº›é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚APIå¯†é’¥
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ models/              &lt;-- M: æ•°æ®ç®¡ç†å‘˜çš„å®¶ (å­˜æ”¾ Pydantic æ¨¡å‹)
â”‚   â”‚   â”œâ”€â”€ item_model.py
â”‚   â”‚   â”œâ”€â”€ user_model.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ schemas/             &lt;-- æœ‰æ—¶å€™ä¹Ÿä¼šæŠŠ Pydantic æ¨¡å‹å« schemasï¼Œå’Œ models ç±»ä¼¼
â”‚   â”‚   â”œâ”€â”€ item_schema.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ services/            &lt;-- P: é€»è¾‘å¤„ç†å‘˜çš„åŠå…¬å®¤ (å­˜æ”¾ä¸šåŠ¡é€»è¾‘)
â”‚   â”‚   â”œâ”€â”€ item_service.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ routers/             &lt;-- C: äº¤é€šæŒ‡æŒ¥å‘˜çš„å²—ä½ (å­˜æ”¾è·¯å¾„æ“ä½œ/APIæ¥å£å®šä¹‰)
â”‚   â”‚   â”œâ”€â”€ items_router.py
â”‚   â”‚   â”œâ”€â”€ users_router.py
â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â””â”€â”€ dependencies.py      &lt;-- æ”¾ä¸€äº›é€šç”¨çš„â€œå¥½å¸®æ‰‹â€ï¼ˆä¾èµ–é¡¹ï¼‰
â”‚
â”œâ”€â”€ tests/                   &lt;-- å†™æµ‹è¯•ä»£ç çš„åœ°æ–¹ (æˆ‘ä»¬æš‚æ—¶ä¸è®²è¿™ä¸ª)
â”œâ”€â”€ requirements.txt         &lt;-- é¡¹ç›®éœ€è¦å®‰è£…å“ªäº›ç¬¬ä¸‰æ–¹åº“å†™åœ¨è¿™é‡Œ
â””â”€â”€ .env                     &lt;-- (å¯é€‰) å­˜æ”¾ä¸€äº›æ•æ„Ÿé…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“å¯†ç 
                    </pre>
                </div>
                <p>è¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä¸åŒé¡¹ç›®å¯èƒ½ä¼šæœ‰äº›ä¸ä¸€æ ·ï¼Œä½†æ ¸å¿ƒæ€æƒ³å°±æ˜¯æŠŠä¸åŒåŠŸèƒ½çš„ä»£ç åˆ†é—¨åˆ«ç±»æ”¾å¥½ã€‚</p>
            </section>

            <section id="mcp-example-setup">
                <h3><span class="emoji">ğŸ› ï¸</span>21.3 æ­å»ºä¸€ä¸ªè¿·ä½  MCP æ¶å­</h3>
                <p>æˆ‘ä»¬æ¥åŠ¨æ‰‹æ­ä¸€ä¸ªæœ€æœ€ç®€å•çš„æ¶å­ï¼Œä¸ºä¸‹ä¸€ç«™çš„å¤©æ°”æŸ¥è¯¢åº”ç”¨åšå‡†å¤‡ã€‚</p>
                <p><strong>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæ–‡ä»¶å¤¹ç»“æ„</strong></p>
                <p>åœ¨ä½ çš„ç”µè„‘ä¸Šï¼Œå…ˆåˆ›å»ºä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚å« <code>my_weather_app</code>ã€‚ç„¶ååœ¨é‡Œé¢åˆ›å»ºè¿™æ ·çš„ç»“æ„ï¼š</p>
                <pre><code>
my_weather_app/
â””â”€â”€ app/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ main.py
    â”œâ”€â”€ core/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ config.py
    â”œâ”€â”€ schemas/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ weather_schema.py
    â”œâ”€â”€ services/
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ weather_service.py
    â””â”€â”€ routers/
        â”œâ”€â”€ __init__.py
        â””â”€â”€ weather_router.py
                </code></pre>
                <p>ä½ å¯ä»¥æ‰‹åŠ¨åˆ›å»ºè¿™äº›æ–‡ä»¶å¤¹å’Œç©ºçš„ <code>.py</code> æ–‡ä»¶ã€‚<code>__init__.py</code> æ–‡ä»¶å¯ä»¥æ˜¯ç©ºçš„ï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰ Python è¿™ä¸ªæ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªå¯ä»¥å¯¼å…¥çš„â€œåŒ…â€ã€‚</p>

                <p><strong>ç¬¬äºŒæ­¥ï¼šå®‰è£… FastAPI å’Œ Uvicorn</strong></p>
                <p>å¦‚æœä½ è¿˜æ²¡è£…ï¼Œæ‰“å¼€ä½ çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¾“å…¥ï¼š</p>
                <div class="note">
                    <p><span class="emoji">ğŸ’¬</span> <strong>AIæç¤ºè¯å‚è€ƒ</strong>: "æˆ‘éœ€è¦å®‰è£… FastAPI å’Œ Uvicorn è¿™ä¸¤ä¸ª Python åŒ…ï¼Œå‘Šè¯‰æˆ‘ pip å®‰è£…å‘½ä»¤ã€‚"</p>
                </div>
                <pre><code class="language-bash">pip install fastapi uvicorn[standard]</code></pre>

                <p><strong>ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ä¸»åº”ç”¨æ–‡ä»¶ <code>app/main.py</code></strong></p>
                <p>è¿™ä¸ªæ–‡ä»¶æ˜¯æ•´ä¸ª FastAPI åº”ç”¨çš„å…¥å£ã€‚å®ƒä¼šåˆ›å»º FastAPI åº”ç”¨å®ä¾‹ï¼Œå¹¶ä¸”æŠŠæˆ‘ä»¬åé¢è¦å†™çš„â€œäº¤é€šæŒ‡æŒ¥å‘˜â€ï¼ˆroutersï¼‰åŒ…å«è¿›æ¥ã€‚</p>
                <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>ä»£ç è§£é‡Š</strong>ï¼šä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª FastAPI åº”ç”¨ï¼Œå¹¶å‘Šè¯‰å®ƒå» <code>app.routers.weather_router</code> è¿™ä¸ªæ–‡ä»¶é‡Œæ‰¾è·Ÿå¤©æ°”ç›¸å…³çš„ç½‘å€è·¯å¾„ã€‚</p>
                </div>
                <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘æƒ³ç”¨ FastAPI åˆ›å»ºä¸€ä¸ªåº”ç”¨ã€‚è¯·å¸®æˆ‘å†™ä¸€ä¸ª <code>main.py</code> æ–‡ä»¶ï¼Œå®ƒèƒ½åˆ›å»ºä¸€ä¸ª FastAPI å®ä¾‹ï¼Œå¹¶ä¸”èƒ½æŠŠä¸€ä¸ªå«åš <code>weather_router.py</code> æ–‡ä»¶é‡Œçš„ç½‘å€è·¯å¾„åŒ…å«è¿›æ¥ã€‚å‡è®¾ <code>weather_router.py</code> åœ¨ <code>app.routers</code> æ–‡ä»¶å¤¹ä¸‹ã€‚"</p>
                </div>
                <pre><code class="language-python"># æ–‡ä»¶: my_weather_app/app/main.py

from fastapi import FastAPI
from .routers import weather_router # ä»åŒçº§ç›®å½•çš„ routers åŒ…å¯¼å…¥ weather_router

# åˆ›å»ºä¸€ä¸ª FastAPI çš„â€œæ€»ç®¡å®¶â€å®ä¾‹
app = FastAPI(title="æˆ‘çš„å¤©æ°”åº”ç”¨MCPç‰ˆ")

# æŠŠå¤©æ°”ç›¸å…³çš„â€œäº¤é€šæŒ‡æŒ¥â€å·¥ä½œäº¤ç»™ weather_router æ¥å¤„ç†
# prefix="/api/v1" çš„æ„æ€æ˜¯ï¼Œæ‰€æœ‰ weather_router é‡Œçš„ç½‘å€éƒ½ä¼šè‡ªåŠ¨åŠ ä¸Š /api/v1 è¿™ä¸ªå‰ç¼€
# tags=["Weather"] æ˜¯ç»™ API æ–‡æ¡£é‡ŒåŠ ä¸ªæ ‡ç­¾ï¼Œæ–¹ä¾¿æŸ¥æ‰¾
app.include_router(weather_router.router, prefix="/api/v1/weather", tags=["Weather API"])

# ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œç›´æ¥å®šä¹‰ä¸€äº›å…¨å±€çš„æ¥å£ï¼Œå¦‚æœéœ€è¦çš„è¯
@app.get("/")
async def read_root():
    return {"message": "æ¬¢è¿æ¥åˆ°æˆ‘çš„å¤©æ°”åº”ç”¨ï¼è¯·è®¿é—® /docs æŸ¥çœ‹ API æ–‡æ¡£ã€‚"}

# å¦‚æœä½ æƒ³ç›´æ¥è¿è¡Œè¿™ä¸ª main.py (è™½ç„¶é€šå¸¸æˆ‘ä»¬ä¼šç”¨ uvicorn å‘½ä»¤æ¥è¿è¡Œ)
# å¯ä»¥åŠ ä¸Šä¸‹é¢çš„ä»£ç ï¼Œä½†å¯¹äº MCP ç»“æ„ï¼Œæ›´æ¨èåœ¨é¡¹ç›®æ ¹ç›®å½•ç”¨ uvicorn å¯åŠ¨
# import uvicorn
# if __name__ == "__main__":
#     uvicorn.run("main:app", host="127.0.0.1", port=8000, reload=True)
</code></pre>
                <p>ç°åœ¨æˆ‘ä»¬çš„æ¶å­åˆæ­¥æ­å¥½äº†ï¼å…¶ä»–çš„æ–‡ä»¶ (<code>config.py</code>, <code>weather_schema.py</code>, <code>weather_service.py</code>, <code>weather_router.py</code>) è¿˜æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç«™å¡«å……å®ƒä»¬çš„å†…å®¹æ¥åšä¸€ä¸ªçœŸæ­£çš„å¤©æ°”æŸ¥è¯¢åº”ç”¨ã€‚</p>
            </section>
            <footer class="mt-12 pt-6 border-t border-gray-300 text-center text-sm text-gray-500">
                <p><span class="emoji">ğŸ—ï¸</span> FastAPI æ¢é™©ç¬¬äºŒåä¸€ç«™å®Œæˆï¼æˆ‘ä»¬å­¦ä¼šäº†ç»™é¡¹ç›®æ­ä¸ªæ•´é½çš„â€œæ¶å­â€ï¼ <span class="emoji">ğŸ—ï¸</span></p>
            </footer>
        </section>
        <hr class="section-divider">

        <section id="lesson22-weather-mcp">
            <h2><span class="emoji">ğŸŒ¦ï¸</span>ç¬¬äºŒåäºŒç«™: å®æˆ˜ï¼ç”¨ MCP æ¶æ„åšä¸ªå¤©æ°”æŸ¥è¯¢åº”ç”¨</h2>
            <p>ä¸Šä¸€ç«™æˆ‘ä»¬æ­å¥½äº† FastAPI MCP é¡¹ç›®çš„â€œéª¨æ¶â€ï¼Œç°åœ¨æˆ‘ä»¬è¦å¾€é‡Œé¢å¡«å……â€œè¡€è‚‰â€ï¼Œåšä¸€ä¸ªèƒ½æŸ¥è¯¢å¤©æ°”çš„å°åº”ç”¨ï¼</p>
            <p>æˆ‘ä»¬ä¼šç”¨åˆ°ä¸€ä¸ªå…è´¹çš„å¤©æ°” API (æ¯”å¦‚ Open-Meteoï¼Œå®ƒä¸éœ€è¦ API Keyï¼Œå¾ˆæ–¹ä¾¿æµ‹è¯•) æ¥è·å–çœŸå®çš„å¤©æ°”æ•°æ®ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æ¢æˆå…¶ä»–çš„å¤©æ°”æœåŠ¡ã€‚</p>
            <div class="note">
                <p><span class="emoji">âš™ï¸</span> <strong>é‡è¦å‰æ</strong>ï¼šè¿™ä¸ªä¾‹å­ä¼šç”¨åˆ° <code>requests</code> åº“æ¥å‘å¤–éƒ¨å¤©æ°” API å‘é€è¯·æ±‚ã€‚å¦‚æœä½ è¿˜æ²¡å®‰è£…ï¼Œè¯·å…ˆå®‰è£…å®ƒï¼š</p>
                <div class="ai-prompt" style="margin-top: 0.5em;">
                     <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘éœ€è¦åœ¨ Python é‡Œå‘ HTTP è¯·æ±‚ï¼Œè¯·å‘Šè¯‰æˆ‘æ€ä¹ˆå®‰è£… requests åº“ã€‚"</p>
                </div>
                <pre><code class="language-bash">pip install requests</code></pre>
            </div>

            <section id="weather-schemas">
                <h3><span class="emoji">ğŸ“</span>22.1 å®šä¹‰â€œå¤©æ°”æ•°æ®â€é•¿å•¥æ ·ï¼š<code>app/schemas/weather_schema.py</code></h3>
                <p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç”¨ Pydantic æ¨¡å‹æ¥å®šä¹‰æˆ‘ä»¬æœŸæœ›ä»å¤©æ°” API è·å–çš„æ•°æ®ï¼Œä»¥åŠæˆ‘ä»¬æƒ³å›å¤ç»™å®¢æˆ·ç«¯çš„æ•°æ®åº”è¯¥æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™éƒ¨åˆ†ä»£ç æ”¾åœ¨ <code>app/schemas/weather_schema.py</code> æ–‡ä»¶é‡Œã€‚</p>
                <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>ä»£ç è§£é‡Š</strong>ï¼šä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸¤ä¸ªâ€œæ•°æ®è“å›¾â€ã€‚<code>WeatherApiResponse</code> æè¿°äº†æˆ‘ä»¬ä»å¤–éƒ¨å¤©æ°”æœåŠ¡é‚£é‡Œå¯èƒ½æ”¶åˆ°çš„å¤æ‚æ•°æ®ä¸­çš„ä¸€éƒ¨åˆ†ã€‚<code>WeatherResponse</code> åˆ™æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³å±•ç¤ºç»™ç”¨æˆ·çœ‹çš„ã€æ›´ç®€æ´çš„å¤©æ°”ä¿¡æ¯ã€‚</p>
                </div>
                <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘æƒ³ç”¨ Pydantic å®šä¹‰ä¸¤ä¸ªæ•°æ®æ¨¡å‹ã€‚ç¬¬ä¸€ä¸ªå« <code>WeatherApiResponse</code>ï¼Œå®ƒé‡Œé¢åº”è¯¥æœ‰ä¸€ä¸ªå« <code>current_weather</code> çš„å­—æ®µï¼Œè¿™ä¸ªå­—æ®µæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å« <code>temperature</code> (æ•°å­—) å’Œ <code>weathercode</code> (æ•°å­—)ã€‚ç¬¬äºŒä¸ªæ¨¡å‹å« <code>WeatherResponse</code>ï¼Œå®ƒåº”è¯¥æœ‰ <code>city</code> (å­—ç¬¦ä¸²)ã€<code>temperature</code> (æ•°å­—ï¼Œæ‘„æ°åº¦)ã€<code>weather_description</code> (å­—ç¬¦ä¸²) è¿™å‡ ä¸ªå­—æ®µã€‚"</p>
                </div>
                <pre><code class="language-python"># æ–‡ä»¶: my_weather_app/app/schemas/weather_schema.py

from pydantic import BaseModel

# è¿™ä¸ªæ¨¡å‹ç”¨æ¥æè¿°æˆ‘ä»¬ä» Open-Meteo API å¯èƒ½æ”¶åˆ°çš„éƒ¨åˆ†æ•°æ®ç»“æ„
# æˆ‘ä»¬åªå…³å¿ƒ current_weather é‡Œçš„ temperature å’Œ weathercode
class CurrentWeather(BaseModel):
    temperature: float
    weathercode: int

class WeatherApiResponse(BaseModel):
    current_weather: CurrentWeather

# è¿™æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³å›å¤ç»™å®¢æˆ·ç«¯çš„å¤©æ°”ä¿¡æ¯æ¨¡å‹
class WeatherResponse(BaseModel):
    city: str
    temperature_celsius: float
    weather_description: str
    source: str = "Open-Meteo" # å¯ä»¥åŠ ä¸€ä¸ªæ•°æ®æ¥æºå­—æ®µ
</code></pre>
            </section>

            <section id="weather-config">
                <h3><span class="emoji">âš™ï¸</span>22.2 é…ç½®ä¿¡æ¯ï¼š<code>app/core/config.py</code></h3>
                <p>å¦‚æœæˆ‘ä»¬çš„åº”ç”¨éœ€è¦ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚ç¬¬ä¸‰æ–¹ API çš„åœ°å€ã€API å¯†é’¥ç­‰ï¼Œé€šå¸¸ä¼šæŠŠå®ƒä»¬æ”¾åœ¨ä¸€ä¸ªä¸“é—¨çš„é…ç½®æ–‡ä»¶é‡Œã€‚è¿™é‡Œæˆ‘ä»¬æ”¾ä¸€ä¸ª Open-Meteo API çš„åŸºç¡€ç½‘å€ã€‚</p>
                 <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>ä»£ç è§£é‡Š</strong>ï¼šä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªè·å–å¤©æ°” API åŸºç¡€ç½‘å€çš„è®¾ç½®ã€‚</p>
                </div>
                <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘æƒ³åœ¨ FastAPI é¡¹ç›®çš„é…ç½®æ–‡ä»¶é‡Œè®¾ç½®ä¸€ä¸ªå¤©æ°” API çš„åŸºç¡€ç½‘å€ï¼Œè¯·å¸®æˆ‘å†™ä¸€ä¸ª <code>config.py</code>ï¼Œé‡Œé¢åŒ…å«è¿™ä¸ªè®¾ç½®ã€‚"</p>
                </div>
                <pre><code class="language-python"># æ–‡ä»¶: my_weather_app/app/core/config.py

from pydantic_settings import BaseSettings # Pydantic V2 æ¨èç”¨ pydantic-settings

class Settings(BaseSettings):
    OPEN_METEO_API_URL: str = "https://api.open-meteo.com/v1/forecast"
    # å¦‚æœä½ æœ‰ API Keyï¼Œä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ï¼Œæ¯”å¦‚:
    # WEATHER_API_KEY: str = "YOUR_SUPER_SECRET_API_KEY"

    class Config:
        env_file = ".env" # å¯ä»¥è®©é…ç½®ä» .env æ–‡ä»¶åŠ è½½ï¼Œæ›´å®‰å…¨
        env_file_encoding = 'utf-8'

settings = Settings() # åˆ›å»ºä¸€ä¸ªå…¨å±€å¯ç”¨çš„é…ç½®å®ä¾‹
</code></pre>
                <div class="note">
                    <p><span class="emoji">ğŸ’¡</span> ä¸ºäº†ä½¿ç”¨ <code>pydantic-settings</code>ï¼Œä½ å¯èƒ½éœ€è¦å…ˆå®‰è£…å®ƒï¼š <code>pip install pydantic-settings</code>ã€‚å®ƒå¯ä»¥æ–¹ä¾¿åœ°ä»ç¯å¢ƒå˜é‡æˆ– <code>.env</code> æ–‡ä»¶åŠ è½½é…ç½®ï¼Œè®©ä½ çš„ä»£ç æ›´å®‰å…¨ã€æ›´çµæ´»ã€‚</p>
                </div>
            </section>

            <section id="weather-service">
                <h3><span class="emoji">ğŸ‘¨â€ğŸ”§</span>22.3 â€œå¤©æ°”é¢„æŠ¥å‘˜â€ï¼š<code>app/services/weather_service.py</code></h3>
                <p>è¿™ä¸ªæ–‡ä»¶é‡Œæ”¾çš„æ˜¯çœŸæ­£å¹²æ´»çš„â€œå·¥äººâ€â€”â€”å¤©æ°”æœåŠ¡é€»è¾‘ã€‚å®ƒä¼šè´Ÿè´£å»è°ƒç”¨å¤–éƒ¨çš„å¤©æ°” APIï¼Œè·å–æ•°æ®ï¼Œç„¶åå¯èƒ½åšä¸€äº›å¤„ç†ï¼Œè½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„æ ¼å¼ã€‚</p>
                 <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>ä»£ç è§£é‡Š</strong>ï¼šä¸‹é¢çš„ä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>get_weather_data</code>ï¼Œå®ƒä¼šæ ¹æ®åŸå¸‚åï¼ˆé€šè¿‡ç»çº¬åº¦ï¼‰å»ä¸€ä¸ªå¤©æ°”ç½‘ç«™è¯·æ±‚æ•°æ®ï¼Œç„¶åæŠŠæ‹¿åˆ°çš„æ¸©åº¦å’Œå¤©æ°”ä»£ç è½¬æ¢æˆæˆ‘ä»¬å®¹æ˜“ç†è§£çš„æè¿°ã€‚</p>
                </div>
                <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "å¸®æˆ‘å†™ä¸€ä¸ª Python å‡½æ•°ï¼Œå«åš <code>get_weather_data</code>ã€‚å®ƒæ¥æ”¶åŸå¸‚åä½œä¸ºå‚æ•°ã€‚å‡½æ•°å†…éƒ¨éœ€è¦æ ¹æ®åŸå¸‚åæŸ¥åˆ°å¯¹åº”çš„ç»çº¬åº¦ï¼ˆè¿™é‡Œå¯ä»¥å…ˆå†™æ­»å‡ ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åŒ—äº¬ã€ä¸Šæµ·ï¼‰ï¼Œç„¶åç”¨ <code>requests</code> åº“å» Open-Meteo çš„ API (ç½‘å€æ˜¯ <code>https://api.open-meteo.com/v1/forecast</code>) è¯·æ±‚è¿™ä¸ªç»çº¬åº¦çš„å½“å‰å¤©æ°”ï¼Œå‚æ•°è¦åŒ…å« <code>latitude</code>, <code>longitude</code>, å’Œ <code>current_weather=true</code>ã€‚æ‹¿åˆ°è¿”å›çš„ JSON æ•°æ®åï¼Œæå–å‡ºæ¸©åº¦å’Œå¤©æ°”ä»£ç ã€‚æœ€åï¼Œæ ¹æ®å¤©æ°”ä»£ç ï¼ˆæ¯”å¦‚0æ˜¯æ™´å¤©ï¼Œ1æ˜¯å°‘äº‘ç­‰ï¼‰è¿”å›ä¸€ä¸ªåŒ…å«åŸå¸‚åã€æ¸©åº¦ï¼ˆæ‘„æ°åº¦ï¼‰å’Œå¤©æ°”æè¿°çš„å­—å…¸ã€‚"</p>
                </div>
                <pre><code class="language-python"># æ–‡ä»¶: my_weather_app/app/services/weather_service.py

import requests
from ..schemas.weather_schema import WeatherApiResponse, WeatherResponse # å¯¼å…¥æˆ‘ä»¬å®šä¹‰çš„æ•°æ®æ¨¡å‹
from ..core.config import settings # å¯¼å…¥é…ç½®

# åŸå¸‚ç»çº¬åº¦çš„ä¸€ä¸ªç®€å•æ˜ å°„ï¼ŒçœŸå®åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å®Œå–„çš„åœ°ç†ç¼–ç æœåŠ¡
CITY_COORDINATES = {
    "åŒ—äº¬": {"latitude": 39.9042, "longitude": 116.4074},
    "ä¸Šæµ·": {"latitude": 31.2304, "longitude": 121.4737},
    "å¹¿å·": {"latitude": 23.1291, "longitude": 113.2644},
    "æ·±åœ³": {"latitude": 22.5431, "longitude": 114.0579},
    "ä¸œäº¬": {"latitude": 35.6895, "longitude": 139.6917},
}

# å¤©æ°”ä»£ç åˆ°æè¿°çš„ç®€å•æ˜ å°„ (æ¥è‡ª Open-Meteo æ–‡æ¡£)
WEATHER_CODES_DESCRIPTION = {
    0: "æ™´æœ—",
    1: "å°‘äº‘",
    2: "å±€éƒ¨å¤šäº‘",
    3: "é˜´å¤©",
    45: "é›¾",
    48: "å†»é›¾",
    51: "æ¯›æ¯›é›¨(å¼±)",
    53: "æ¯›æ¯›é›¨(ä¸­)",
    55: "æ¯›æ¯›é›¨(å¼º)",
    # ...å¯ä»¥æ·»åŠ æ›´å¤šå¤©æ°”ä»£ç ...
    61: "å°é›¨",
    63: "ä¸­é›¨",
    65: "å¤§é›¨",
    80: "é˜µé›¨(å¼±)",
    81: "é˜µé›¨(ä¸­)",
    82: "é˜µé›¨(å¼º)",
}

async def get_weather_data_for_city(city: str) -> WeatherResponse | None:
    if city not in CITY_COORDINATES:
        return None # åŸå¸‚ä¸åœ¨æˆ‘ä»¬çš„åˆ—è¡¨é‡Œ

    coords = CITY_COORDINATES[city]
    
    params = {
        "latitude": coords["latitude"],
        "longitude": coords["longitude"],
        "current_weather": "true" # å‘Šè¯‰ API æˆ‘ä»¬æƒ³è¦å½“å‰å¤©æ°”
    }
    
    try:
        # å‘é€ GET è¯·æ±‚åˆ°å¤©æ°” API
        response = requests.get(settings.OPEN_METEO_API_URL, params=params)
        response.raise_for_status() # å¦‚æœè¯·æ±‚å¤±è´¥ (æ¯”å¦‚4xxæˆ–5xxé”™è¯¯)ï¼Œè¿™é‡Œä¼šæŠ›å‡ºå¼‚å¸¸
        
        api_data = response.json()
        
        # ç”¨ Pydantic æ¨¡å‹æ¥æ ¡éªŒå’Œè§£ææ”¶åˆ°çš„æ•°æ®
        # æˆ‘ä»¬åªå…³å¿ƒ WeatherApiResponse é‡Œå®šä¹‰çš„éƒ¨åˆ†
        parsed_api_data = WeatherApiResponse(**api_data)
        
        temperature = parsed_api_data.current_weather.temperature
        weather_code = parsed_api_data.current_weather.weathercode
        
        weather_description = WEATHER_CODES_DESCRIPTION.get(weather_code, "æœªçŸ¥å¤©æ°”ä»£ç ")
        
        return WeatherResponse(
            city=city,
            temperature_celsius=temperature,
            weather_description=weather_description
        )
        
    except requests.exceptions.RequestException as e:
        print(f"è¯·æ±‚å¤©æ°” API å‡ºé”™: {e}")
        return None
    except Exception as e: # æ•è· Pydantic æ ¡éªŒé”™è¯¯æˆ–å…¶ä»–æ„å¤–é”™è¯¯
        print(f"å¤„ç†å¤©æ°”æ•°æ®å‡ºé”™: {e}")
        return None

</code></pre>
            </section>

            <section id="weather-router">
                <h3><span class="emoji">ğŸš¦</span>22.4 â€œå¤©æ°”é¢„æŠ¥æŒ‡æŒ¥ä¸­å¿ƒâ€ï¼š<code>app/routers/weather_router.py</code></h3>
                <p>è¿™ä¸ªæ–‡ä»¶æ˜¯æˆ‘ä»¬çš„â€œäº¤é€šæŒ‡æŒ¥å‘˜â€ã€‚å®ƒå®šä¹‰äº†ç”¨æˆ·å¯ä»¥é€šè¿‡å“ªä¸ªç½‘å€æ¥æŸ¥è¯¢å¤©æ°”ï¼Œä»¥åŠå½“ç”¨æˆ·è®¿é—®è¿™ä¸ªç½‘å€æ—¶ï¼Œåº”è¯¥è°ƒç”¨å“ªä¸ªâ€œæœåŠ¡å‘˜â€ï¼ˆä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼‰æ¥å¤„ç†ã€‚</p>
                <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>ä»£ç è§£é‡Š</strong>ï¼šä¸‹é¢çš„ä»£ç åˆ›å»ºäº†ä¸€ä¸ª API è·¯å¾„ <code>/query/{city}</code>ã€‚å½“ç”¨æˆ·è®¿é—®æ¯”å¦‚ <code>/query/åŒ—äº¬</code> æ—¶ï¼Œå®ƒä¼šè°ƒç”¨æˆ‘ä»¬ä¹‹å‰å†™çš„ <code>get_weather_data_for_city</code> å‡½æ•°ï¼Œå¹¶æŠŠæŸ¥è¯¢åˆ°çš„å¤©æ°”ä¿¡æ¯ï¼ˆæˆ–è€…é”™è¯¯æç¤ºï¼‰è¿”å›ç»™ç”¨æˆ·ã€‚</p>
                </div>
                <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘æƒ³ç”¨ FastAPI åˆ›å»ºä¸€ä¸ªè·å–åŸå¸‚å¤©æ°”çš„ API æ¥å£ã€‚ç½‘å€åº”è¯¥æ˜¯ <code>/query/{city}</code>ï¼Œå…¶ä¸­ <code>city</code> æ˜¯è·¯å¾„å‚æ•°ï¼Œä»£è¡¨åŸå¸‚åã€‚è¿™ä¸ªæ¥å£åº”è¯¥è°ƒç”¨ä¸€ä¸ªå«åš <code>get_weather_data_for_city</code> çš„æœåŠ¡å‡½æ•°æ¥è·å–å¤©æ°”æ•°æ®ã€‚å¦‚æœæ‰¾åˆ°äº†å¤©æ°”ï¼Œå°±è¿”å› <code>WeatherResponse</code> æ¨¡å‹å®šä¹‰çš„æ•°æ®ï¼›å¦‚æœåŸå¸‚æ‰¾ä¸åˆ°æˆ–è€…å‡ºé”™äº†ï¼Œå°±è¿”å›ä¸€ä¸ª 404 é”™è¯¯ï¼Œæç¤ºåŸå¸‚æœªæ‰¾åˆ°æˆ–è·å–å¤©æ°”å¤±è´¥ã€‚"</p>
                </div>
                <pre><code class="language-python"># æ–‡ä»¶: my_weather_app/app/routers/weather_router.py

from fastapi import APIRouter, HTTPException, Path, Depends
from typing import Annotated

from ..services import weather_service # ä»åŒçº§ç›®å½•çš„ services åŒ…å¯¼å…¥ weather_service
from ..schemas.weather_schema import WeatherResponse # å¯¼å…¥æˆ‘ä»¬å®šä¹‰çš„å“åº”æ¨¡å‹

# åˆ›å»ºä¸€ä¸ª APIRouter å®ä¾‹ï¼Œå°±åƒæ˜¯ FastAPI app çš„ä¸€ä¸ªâ€œåˆ†èº«â€
# ä¸“é—¨ç”¨æ¥ç®¡ç†å’Œå¤©æ°”ç›¸å…³çš„ç½‘å€è·¯å¾„
router = APIRouter()

@router.get(
    "/query/{city}", # city æ˜¯è·¯å¾„å‚æ•°
    response_model=WeatherResponse, # å‘Šè¯‰ FastAPIï¼ŒæˆåŠŸæ—¶è¿”å›çš„æ•°æ®ä¼šæ˜¯ WeatherResponse çš„å½¢çŠ¶
    summary="è·å–æŒ‡å®šåŸå¸‚å½“å‰å¤©æ°”",
    description="è¾“å…¥åŸå¸‚ä¸­æ–‡åï¼Œä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€ä¸œäº¬"
)
async def get_city_weather(
    city: Annotated[str, Path(description="è¦æŸ¥è¯¢çš„åŸå¸‚åç§°ï¼Œä¾‹å¦‚: åŒ—äº¬")]
):
    """
    æ ¹æ®åŸå¸‚åç§°è·å–å½“å‰å¤©æ°”ä¿¡æ¯ã€‚
    - **city**: è¦æŸ¥è¯¢çš„åŸå¸‚åç§° (è·¯å¾„å‚æ•°)ã€‚
    """
    weather_data = await weather_service.get_weather_data_for_city(city)
    if weather_data is None:
        raise HTTPException(
            status_code=404, 
            detail=f"æ— æ³•è·å–åŸå¸‚ '{city}' çš„å¤©æ°”ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åŸå¸‚åç§°æ˜¯å¦æ”¯æŒæˆ–ç¨åå†è¯•ã€‚"
        )
    return weather_data

# ä½ è¿˜å¯ä»¥æ·»åŠ æ›´å¤šå’Œå¤©æ°”ç›¸å…³çš„è·¯ç”±...
</code></pre>
            </section>

            <section id="running-mcp-app">
                <h3><span class="emoji">â–¶ï¸</span>22.5 å¯åŠ¨æˆ‘ä»¬çš„ MCP å¤©æ°”åº”ç”¨ï¼</h3>
                <p>æ‰€æœ‰â€œæˆ¿é—´â€çš„ä»£ç éƒ½å†™å¥½åï¼Œæˆ‘ä»¬æ€ä¹ˆå¯åŠ¨è¿™ä¸ªåº”ç”¨å‘¢ï¼Ÿ</p>
                <p>æ‰“å¼€ä½ çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œ<strong>ç¡®ä¿ä½ åœ¨é¡¹ç›®æ ¹ç›®å½• <code>my_weather_app</code> ä¸‹</strong> (ä¸æ˜¯åœ¨ <code>app</code> æ–‡ä»¶å¤¹é‡Œ)ï¼Œç„¶åè¿è¡Œ Uvicornï¼š</p>
                <div class="tip">
                    <p><span class="emoji">ğŸ’¡</span> <strong>å‘½ä»¤è§£é‡Š</strong>ï¼š<code>uvicorn app.main:app --reload</code></p>
                    <ul>
                        <li><code>app.main</code>: å‘Šè¯‰ Uvicorn å» <code>app</code> æ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰ä¸‹çš„ <code>main.py</code> æ–‡ä»¶é‡Œæ‰¾ã€‚</li>
                        <li><code>:app</code>: å‘Šè¯‰ Uvicornï¼Œåœ¨ <code>main.py</code> æ–‡ä»¶é‡Œï¼Œé‚£ä¸ª FastAPI çš„å®ä¾‹å˜é‡åå« <code>app</code>ã€‚</li>
                        <li><code>--reload</code>: è¿™ä¸ªå‚æ•°éå¸¸æœ‰ç”¨ï¼å®ƒä¼šè®©æœåŠ¡å™¨åœ¨ä½ ä¿®æ”¹å¹¶ä¿å­˜ä»£ç åè‡ªåŠ¨é‡å¯ï¼Œä¸ç”¨ä½ æ‰‹åŠ¨åœæ‰å†å¯åŠ¨ã€‚å¼€å‘çš„æ—¶å€™å¼ºçƒˆæ¨èåŠ ä¸Šï¼</li>
                    </ul>
                </div>
                 <div class="ai-prompt">
                    <p><strong><span class="emoji">ğŸ¤–</span> AIæç¤ºè¯</strong>ï¼š "æˆ‘æœ‰ä¸€ä¸ª FastAPI é¡¹ç›®ï¼Œä¸»åº”ç”¨å®ä¾‹åœ¨ <code>app/main.py</code> æ–‡ä»¶é‡Œçš„ä¸€ä¸ªå« <code>app</code> çš„å˜é‡ã€‚è¯·å‘Šè¯‰æˆ‘ç”¨ uvicorn å¯åŠ¨è¿™ä¸ªåº”ç”¨çš„å‘½ä»¤ï¼Œå¹¶ä¸”è®©å®ƒåœ¨ä»£ç æ”¹åŠ¨åèƒ½è‡ªåŠ¨é‡å¯ã€‚"</p>
                </div>
                <pre><code class="language-bash">uvicorn app.main:app --reload</code></pre>
                <p>å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p>
                <div class="output">INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using statreload
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
</div>
                <p>ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œè¯•è¯•è®¿é—®ï¼š</p>
                <ul>
                    <li><a href="http://127.0.0.1:8000/api/v1/weather/query/åŒ—äº¬" target="_blank" class="text-blue-600 hover:underline">http://127.0.0.1:8000/api/v1/weather/query/åŒ—äº¬</a></li>
                    <li><a href="http://127.0.0.1:8000/api/v1/weather/query/ä¸œäº¬" target="_blank" class="text-blue-600 hover:underline">http://127.0.0.1:8000/api/v1/weather/query/ä¸œäº¬</a></li>
                    <li>æˆ–è€…å» <a href="http://127.0.0.1:8000/docs" target="_blank" class="text-blue-600 hover:underline">http://127.0.0.1:8000/docs</a> çœ‹çœ‹ä½ çš„ API æ–‡æ¡£ï¼Œå¹¶é€šè¿‡æ–‡æ¡£ç•Œé¢æ¥æµ‹è¯•ï¼</li>
                </ul>
                <p>å¦‚æœçœ‹åˆ°è¿”å›çš„å¤©æ°”ä¿¡æ¯ï¼Œæ­å–œä½ ï¼ä½ æˆåŠŸç”¨ MCP æ¶æ„æ­å»ºå¹¶è¿è¡Œäº†ä¸€ä¸ª FastAPI åº”ç”¨ï¼</p>
                <div class="note">
                    <p><span class="emoji">ğŸ› ï¸</span> <strong>è°ƒè¯•å°æŠ€å·§</strong>ï¼š</p>
                    <ul>
                        <li>å¦‚æœåœ¨å¯åŠ¨æˆ–è¿è¡Œæ—¶é‡åˆ° "ModuleNotFoundError" (æ‰¾ä¸åˆ°æ¨¡å—)ï¼Œé€šå¸¸æ˜¯å› ä¸ºä½ è¿è¡Œ <code>uvicorn</code> å‘½ä»¤çš„è·¯å¾„ä¸å¯¹ï¼Œæˆ–è€…ä½ çš„æ–‡ä»¶å¤¹ç»“æ„ã€<code>__init__.py</code> æ–‡ä»¶ã€å¯¼å…¥è¯­å¥ (æ¯”å¦‚ <code>from ..schemas import ...</code> é‡Œçš„ç‚¹ç‚¹ <code>..</code>) æœ‰é—®é¢˜ã€‚ç¡®ä¿ä½ æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½• (<code>my_weather_app</code>) è¿è¡Œå‘½ä»¤ã€‚</li>
                        <li>ä»”ç»†æ£€æŸ¥æ¯ä¸ªæ–‡ä»¶é‡Œçš„å¯¼å…¥è¯­å¥æ˜¯ä¸æ˜¯æ­£ç¡®æŒ‡å‘äº†å…¶ä»–æ–‡ä»¶ã€‚</li>
                        <li><code>print()</code> è¯­å¥æ˜¯ä½ è°ƒè¯•çš„å¥½æœ‹å‹ï¼å¯ä»¥åœ¨å„ä¸ªå‡½æ•°é‡ŒåŠ ä¸Šæ‰“å°è¾“å‡ºæ¥çœ‹çœ‹ç¨‹åºæ‰§è¡Œåˆ°äº†å“ªé‡Œï¼Œå˜é‡çš„å€¼æ˜¯ä»€ä¹ˆã€‚</li>
                    </ul>
                </div>
            </section>

            <footer class="mt-12 pt-6 border-t border-gray-300 text-center text-sm text-gray-500">
                <p><span class="emoji">ğŸ‰</span> FastAPI æ¢é™©ç¬¬äºŒåäºŒç«™ï¼Œä¹Ÿæ˜¯æœ¬æ¬¡ MCP ç¯‡ç« çš„ç»ˆç‚¹ç«™ï¼Œåœ†æ»¡å®Œæˆï¼ä½ å¤ªæ£’äº†ï¼ <span class="emoji">ğŸ‰</span></p>
                <p>é€šè¿‡è¿™ä¸¤ç«™çš„å­¦ä¹ ï¼Œä½ ä¸ä»…äº†è§£äº† MCP è¿™ç§è®©ä»£ç æ›´æœ‰æ¡ç†çš„æ–¹æ³•ï¼Œè¿˜äº²æ‰‹åšäº†ä¸€ä¸ªèƒ½æŸ¥å¤©æ°”çš„å°åº”ç”¨ï¼å¸Œæœ›è¿™æ¬¡æ¢é™©èƒ½è®©ä½ å¯¹ FastAPI æœ‰æ›´æ·±çš„ç†è§£ï¼Œä¹Ÿå¯¹ç¼–ç¨‹æ›´æœ‰ä¿¡å¿ƒï¼</p>
            </footer>
        </section>
        </div>
</body>
</html>
